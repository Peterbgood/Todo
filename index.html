$(document).ready(function() {
    let currentListId = Date.now();

    loadTasks();
    loadHeading();
    populateListSelector();

    // Add task on enter key press
    $('#todo-input').keypress(function(e) {
        if (e.which === 13) {
            addTask();
        }
    });

    // Add task on button click
    $('#add-btn').click(addTask);

    // Delete task
    $(document).on('click', '.delete-btn', deleteTask);

    // Move task up
    $(document).on('click', '.up-btn', moveTaskUp);

    // Reset all tasks
    $('#reset-btn').click(resetTasks);

    // Create new list
    $('#new-list-btn').click(function() {
        var newListName = prompt("Enter new list name:");
        if (newListName !== null && newListName.trim() !== '') {
            createNewList(newListName);
            saveHeading(); // Save new list name as heading
        }
    });

    // Switch to selected list
    $('#list-selector').change(function() {
        var selectedListId = $(this).val();
        if (selectedListId !== '') {
            currentListId = selectedListId;
            loadTasks();
        }
    });

    // Save h1 content to local storage
    function saveHeading() {
        var heading = $('h1').text().trim();
        localStorage.setItem('heading', heading);
    }

    // Load h1 content from local storage
    function loadHeading() {
        var storedHeading = localStorage.getItem('heading');
        if (storedHeading) {
            $('h1').text(storedHeading);
        } else {
            $('h1').text('Max'); // Default heading
        }
    }

    function createNewList(listName) {
        currentListId = Date.now();
        saveTasks();
        $('#todo-list').empty();
        $('h1').text(listName); // Update heading with new list name
        saveHeading();
        localStorage.setItem(`list_${currentListId}`, JSON.stringify([]));
        saveListName(currentListId, listName);
        populateListSelector();
    }

    function addTask() {
        var task = $('#todo-input').val();
        if (task !== '') {
            var taskHtml = '<li class="todo-item">' + 
                '<span>' + task.trim() + '</span>' + 
                '<div class="">' + 
                    '<button class="up-btn btn btn-sm btn-primary mx-1">Up</button>' + 
                    '<button class="delete-btn btn btn-sm btn-danger">Delete</button>' + 
                '</div>' + 
            '</li>';
            $('#todo-list').append(taskHtml);
            $('#todo-input').val('');
            saveTasks();
        }
    }

    function deleteTask() {
        $(this).parent().parent().remove();
        saveTasks();
    }

    function moveTaskUp() {
        var task = $(this).parent().parent();
        task.prev().before(task.get());
        saveTasks();
    }

    function resetTasks() {
        $('#todo-list').empty();
        localStorage.removeItem(`list_${currentListId}`);
        $('h1').text('Max'); 
        localStorage.removeItem('heading'); 
    }

    function saveTasks() {
        var tasks = [];
        $('#todo-list li').each(function() {
            tasks.push($(this).find('span').text().trim());
        });
        localStorage.setItem(`list_${currentListId}`, JSON.stringify(tasks));
        saveHeading(); 
    }

    function loadTasks() {
        $('#todo-list').empty();
        var storedTasks = JSON.parse(localStorage.getItem(`list_${currentListId}`));
        if (storedTasks) {
            $.each(storedTasks, function(index, task) {
                var taskHtml = '<li class="todo-item">' + 
                    '<span>' + task.trim() + '</span>' + 
                    '<div class="">' + 
                        '<button class="up-btn btn btn-sm btn-primary mx-1">Up</button>' + 
                        '<button class="delete-btn btn btn-sm btn-danger">Delete</button>' + 
                    '</div>' + 
                '</li>';
                $('#todo-list').append(taskHtml);
            });
        }
    }

    // Load existing lists from local storage
    function loadExistingLists() {
        var existingLists = [];
        for (var key in localStorage) {
            if (key.startsWith('list_') && !key.includes('_name')) {
                existingLists.push(key.replace('list_', ''));
            }
        }
        return existingLists;
    }

        // Populate list selector with existing lists
    function populateListSelector() {
        var existingLists = loadExistingLists();
        $('#list-selector').empty();
        $('#list-selector').append('<option value="">Select a list</option>');
        $.each(existingLists, function(index, listId) {
            var listName = localStorage.getItem(`list_${listId}_name`);
            if (listName !== null) {
                $('#list-selector').append(`<option value="${listId}">${listName}</option>`);
            } else {
                $('#list-selector').append(`<option value="${listId}">Untitled List</option>`);
            }
        });
    }

    // Load existing lists from local storage
    function loadExistingLists() {
        var existingLists = [];
        for (var key in localStorage) {
            if (key.startsWith('list_') && !key.includes('_name')) {
                existingLists.push(key.replace('list_', ''));
            }
        }
        return existingLists;
    }

    // Save list name with list ID
    function saveListName(listId, listName) {
        localStorage.setItem(`list_${listId}_name`, listName);
    }
}); </script></body></html>
